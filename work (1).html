<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans text-gray-900">

    <div class="bg-white border-b flex justify-around sticky top-0 z-50 shadow-sm">
        <button onclick="changeFol('treatment')" id="t-treatment" class="p-4 text-[10px] font-black border-b-4 border-blue-600 text-blue-600">TREATMENT</button>
        <button onclick="changeFol('maintenance')" id="t-maintenance" class="p-4 text-[10px] font-black border-b-4 border-transparent text-gray-400">MAINTENANCE</button>
        <button onclick="changeFol('recall')" id="t-recall" class="p-4 text-[10px] font-black border-b-4 border-transparent text-gray-400">RECALL</button>
    </div>

    <div class="p-4 max-w-md mx-auto">
        <div class="flex justify-between items-center mb-4">
            <h1 id="headerTitle" class="font-black text-xl uppercase tracking-tighter text-blue-800">TREATMENT</h1>
            <button onclick="toggleCycle()" id="cycleBtn" class="bg-yellow-400 text-blue-900 px-3 py-1 rounded-lg font-bold text-xs shadow">CYCLE MODE</button>
        </div>

        <div id="inputSection" class="flex gap-2 mb-6">
            <input id="newInput" type="text" placeholder="Type task here..." class="flex-1 p-4 rounded-2xl border-2 border-gray-200 outline-none shadow-inner bg-white">
            <button onclick="handleAddTask()" class="bg-blue-600 text-white px-8 rounded-2xl font-bold text-2xl shadow-lg active:bg-blue-800">+</button>
        </div>

        <div id="mainList" class="space-y-3"></div>

        <div id="cycleScreen" class="hidden text-center py-4">
            <div class="bg-white p-12 rounded-[40px] shadow-2xl border-4 border-blue-500 mb-8">
                <h2 id="displayTask" class="text-4xl font-black text-gray-800 break-words leading-tight">...</h2>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <button onclick="record('No')" class="bg-red-500 text-white py-6 rounded-3xl font-black text-xl shadow-lg">✕ NO</button>
                <button onclick="record('Yes')" class="bg-green-500 text-white py-6 rounded-3xl font-black text-xl shadow-lg">✓ YES</button>
            </div>
            <button onclick="toggleCycle()" class="text-gray-400 font-bold underline p-4">Exit Cycle Mode</button>
        </div>
    </div>

    <script>
        // Use Global arrays to ensure they are always ready
        var myTasks = [];
        var activeFol = 'treatment';
        var cycleActive = false;
        var cyclePos = 0;

        function handleAddTask() {
            var el = document.getElementById('newInput');
            if (!el.value.trim()) return;
            myTasks.push({ id: Date.now(), txt: el.value, fol: activeFol, res: '' });
            el.value = '';
            refresh();
        }

        function changeFol(f) {
            activeFol = f;
            cycleActive = false;
            refresh();
        }

        function toggleCycle() {
            var filt = myTasks.filter(function(t) { return t.fol === activeFol; });
            if (filt.length === 0) return alert("Nothing to cycle in this folder!");
            cycleActive = !cycleActive;
            cyclePos = 0;
            refresh();
        }

        function record(val) {
            var filt = myTasks.filter(function(t) { return t.fol === activeFol; });
            var cur = filt[cyclePos];
            
            // Per request: Copy to Recall, don't delete original
            myTasks.push({ id: Date.now() + 1, txt: cur.txt, fol: 'recall', res: val });
            
            // Loop forward
            cyclePos = (cyclePos + 1) % filt.length;
            refresh();
        }

        function move(id, target) {
            myTasks.forEach(function(t) { if(t.id === id) t.fol = target; });
            refresh();
        }

        function remove(id) {
            myTasks = myTasks.filter(function(t) { return t.id !== id; });
            refresh();
        }

        function refresh() {
            var L = document.getElementById('mainList');
            var CS = document.getElementById('cycleScreen');
            var IS = document.getElementById('inputSection');
            var HT = document.getElementById('headerTitle');
            var CB = document.getElementById('cycleBtn');

            HT.innerText = activeFol.toUpperCase();
            
            // Update tabs
            ['treatment', 'maintenance', 'recall'].forEach(function(f) {
                var btn = document.getElementById('t-' + f);
                btn.className = "p-4 text-[10px] font-black border-b-4 " + (activeFol === f ? "border-blue-600 text-blue-600" : "border-transparent text-gray-400");
            });

            if (cycleActive) {
                L.style.display = 'none'; IS.style.display = 'none'; CS.style.display = 'block'; CB.style.display = 'none';
                var filtC = myTasks.filter(function(t) { return t.fol === activeFol; });
                document.getElementById('displayTask').innerText = filtC[cyclePos].txt;
            } else {
                L.style.display = 'block'; CS.style.display = 'none'; CB.style.display = (activeFol === 'recall' ? 'none' : 'block');
                IS.style.display = (activeFol === 'recall' ? 'none' : 'flex');
                
                L.innerHTML = '';
                var currentItems = myTasks.filter(function(t) { return t.fol === activeFol; });
                
                if (currentItems.length === 0) {
                    L.innerHTML = '<div class="py-20 text-center text-gray-300 font-black uppercase text-xs tracking-widest">Folder Empty</div>';
                }

                currentItems.forEach(function(t) {
                    var card = document.createElement('div');
                    card.className = "bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center";
                    
                    var btns = '';
                    if (activeFol === 'treatment') {
                        btns = '<button onclick="move('+t.id+',\'maintenance\')" class="bg-blue-100 text-blue-700 px-3 py-2 rounded-xl text-[10px] font-black">TO MAINT.</button>';
                    } else if (activeFol === 'maintenance') {
                        btns = '<button onclick="move('+t.id+',\'treatment\')" class="bg-gray-100 text-gray-500 px-3 py-2 rounded-xl text-[10px] font-black">BACK</button>';
                    } else if (activeFol === 'recall') {
                        var c = t.res === 'Yes' ? 'text-green-500' : 'text-red-500';
                        btns = '<span class="font-black text-xs mr-2 '+c+'">'+t.res.toUpperCase()+'</span>';
                    }

                    card.innerHTML = '<span class="font-bold text-gray-700">' + t.txt + '</span>' + 
                                     '<div class="flex items-center gap-2">' + btns + 
                                     '<button onclick="remove('+t.id+')" class="text-red-300 font-bold px-2 text-lg">✕</button></div>';
                    L.appendChild(card);
                });
            }
        }
        // Run once on load
        refresh();
    </script>
</body>
</html>
