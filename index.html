<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Task Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans text-gray-900 pb-24">

    <div id="profileScreen" class="fixed inset-0 bg-blue-900 z-[100] p-6 flex flex-col items-center overflow-y-auto">
        <h1 class="text-white font-black text-3xl mb-8 mt-10 uppercase tracking-widest text-center">Select Person</h1>
        <div id="profileList" class="w-full max-w-xs space-y-4 mb-8"></div>
        <div class="w-full max-w-xs border-t border-blue-800 pt-6 pb-10">
            <input id="newProfileName" type="text" placeholder="Add new name..." class="w-full p-4 rounded-2xl mb-2 outline-none">
            <button onclick="addProfile()" class="w-full bg-green-500 text-white font-black py-4 rounded-2xl shadow-lg">+ ADD NEW</button>
        </div>
    </div>

    <div id="appUI" class="hidden">
        <div class="bg-white border-b sticky top-0 z-50 shadow-sm">
            <div class="flex justify-between items-center p-2 bg-gray-50 border-b">
                 <button onclick="exitToProfiles()" class="p-2 text-blue-600 font-black text-[10px]">‚¨Ö NAMES</button>
                 <span id="activeUserLabel" class="text-[10px] font-black text-gray-400 uppercase">...</span>
            </div>
            <div class="flex justify-around">
                <button onclick="changeFol('baseline')" id="t-baseline" class="p-4 flex-1 text-[10px] font-black border-b-4 border-blue-600 text-blue-600 uppercase">Baseline</button>
                <button onclick="changeFol('treatment')" id="t-treatment" class="p-4 flex-1 text-[10px] font-black border-b-4 border-transparent text-gray-400 uppercase">Treatment</button>
                <button onclick="changeFol('maintenance')" id="t-maintenance" class="p-4 flex-1 text-[10px] font-black border-b-4 border-transparent text-gray-400 uppercase">Maint.</button>
            </div>
        </div>

        <div class="p-4 max-w-md mx-auto">
            <div class="flex justify-between items-center mb-4">
                <h1 id="headerTitle" class="font-black text-xl uppercase tracking-tighter text-blue-800 italic underline decoration-blue-200">BASELINE</h1>
                <button onclick="toggleCycle()" id="cycleBtn" class="bg-yellow-400 text-blue-900 px-3 py-1 rounded-lg font-bold text-xs shadow-md">CYCLE MODE</button>
            </div>

            <div id="inputSection" class="flex gap-2 mb-6">
                <input id="newInput" type="text" placeholder="Add task..." class="flex-1 p-4 rounded-2xl border-2 border-gray-200 outline-none shadow-inner bg-white">
                <button onclick="handleAddTask()" class="bg-blue-600 text-white px-8 rounded-2xl font-bold text-2xl shadow-lg active:scale-95 transition-transform">+</button>
            </div>

            <div id="mainList" class="space-y-3"></div>

            <div id="cycleScreen" class="hidden text-center py-4">
                <div id="cycleCounter" class="text-blue-500 font-black text-xs mb-2"></div>
                <div class="bg-white p-12 rounded-[40px] shadow-2xl border-4 border-blue-500 mb-8">
                    <h2 id="displayTask" class="text-4xl font-black text-gray-800 break-words leading-tight">...</h2>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button onclick="record('No')" class="bg-red-500 text-white py-6 rounded-3xl font-black text-xl shadow-lg active:bg-red-700">‚úï NO</button>
                    <button onclick="record('Yes')" class="bg-green-500 text-white py-6 rounded-3xl font-black text-xl shadow-lg active:bg-green-700">‚úì YES</button>
                </div>
                <button onclick="toggleCycle()" class="block w-full text-gray-400 font-bold underline p-2">Exit Cycle Mode</button>
            </div>
        </div>

        <div class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around items-center p-2 shadow-[0_-2px_10px_rgba(0,0,0,0.1)] z-50">
            <button onclick="changeFol('trials')" id="t-trials" class="flex flex-col items-center py-2 px-1 rounded-xl w-1/3 transition-all">
                <span class="text-[14px] mb-1">üìä</span>
                <span class="text-[8px] font-black uppercase tracking-tighter">Trial Sheet</span>
            </button>
            <button onclick="changeFol('mastered')" id="t-mastered" class="flex flex-col items-center py-2 px-1 rounded-xl w-1/3 transition-all">
                <span class="text-[14px] mb-1">üèÜ</span>
                <span class="text-[8px] font-black uppercase tracking-tighter">Mastered</span>
            </button>
            <button onclick="changeFol('recall')" id="t-recall" class="flex flex-col items-center py-2 px-1 rounded-xl w-1/3 transition-all">
                <span class="text-[14px] mb-1">üìã</span>
                <span class="text-[8px] font-black uppercase tracking-tighter">History</span>
            </button>
        </div>
    </div>

    <script>
        var profiles = JSON.parse(localStorage.getItem('tt_profiles') || '[]');
        var currentProfile = localStorage.getItem('tt_active_profile') || null;
        var state = { tasks: [], activeFol: 'baseline', isCyc: false, positions: {} };

        function saveAll() {
            localStorage.setItem('tt_profiles', JSON.stringify(profiles));
            localStorage.setItem('tt_active_profile', currentProfile || "");
            if (currentProfile) localStorage.setItem('tt_data_' + currentProfile, JSON.stringify(state));
        }

        function addProfile() {
            var input = document.getElementById('newProfileName');
            var name = input.value.trim();
            if (!name) return alert("Enter a name!");
            if (profiles.includes(name)) return alert("Already exists!");
            profiles.push(name); input.value = '';
            saveAll(); renderProfiles();
        }

        function deleteProfile(name, e) {
            e.stopPropagation();
            if (confirm("Delete all data for " + name + "?")) {
                profiles = profiles.filter(p => p !== name);
                localStorage.removeItem('tt_data_' + name);
                
