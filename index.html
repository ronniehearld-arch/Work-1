<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tracker Pro v6.6.11</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .act-t { border-bottom: 5px solid #4f46e5; color: #4f46e5; font-weight: 900; }
        .hide { display: none !important; }
        button:active { transform: scale(0.95); filter: brightness(0.9); }
        body { -webkit-text-size-adjust: 100%; touch-action: manipulation; }
    </style>
</head>
<body class="bg-gray-100 font-sans pb-24 text-gray-900">

    <div onclick="exitUser()" class="bg-black text-white text-[12px] font-black text-center py-2 uppercase sticky top-0 z-[150] cursor-pointer">
        v6.6.11 | ğŸ‘¤ SWITCH USER
    </div>

    <div id="app-interface" class="hide min-h-screen">
        <div class="bg-white sticky top-9 z-50 shadow-md">
            <div class="flex justify-between p-3 bg-gray-50 border-b text-[11px] font-black uppercase">
                 <button onclick="exitLocation()" class="text-blue-600">â¬… CHANGE LOCATION</button>
                 <span id="user-label" class="text-gray-500"></span>
            </div>
            
            <div class="flex">
                <button onclick="switchTab('baseline')" id="tab-baseline" class="p-5 flex-1 text-[12px] font-black uppercase">Baseline</button>
                <button onclick="switchTab('treatment')" id="tab-treatment" class="p-5 flex-1 text-[12px] font-black uppercase">Treatment</button>
                <button onclick="switchTab('maintenance')" id="tab-maintenance" class="p-5 flex-1 text-[12px] font-black uppercase">Maint</button>
            </div>
        </div>

        <div id="main-list" class="p-4 space-y-4 pb-28 max-w-md mx-auto"></div>

        <div class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around items-center p-3 shadow-lg z-50">
            <button onclick="switchTab('trials')" id="tab-trials" class="flex flex-col items-center w-1/4">
                <span class="text-2xl">ğŸ“Š</span><span class="text-[10px] font-black uppercase mt-1">Trials</span>
            </button>
            <button onclick="switchTab('mastered')" id="tab-mastered" class="flex flex-col items-center w-1/4">
                <span class="text-2xl">ğŸ†</span><span class="text-[10px] font-black uppercase mt-1">Master</span>
            </button>
            <button onclick="switchTab('ta_history')" id="tab-ta_history" class="flex flex-col items-center w-1/4">
                <span class="text-2xl">ğŸ“</span><span class="text-[10px] font-black uppercase mt-1">TA Logs</span>
            </button>
            <button onclick="switchTab('recall')" id="tab-recall" class="flex flex-col items-center w-1/4">
                <span class="text-2xl">ğŸ“‹</span><span class="text-[10px] font-black uppercase mt-1">Recall</span>
            </button>
        </div>
    </div>

    <div id="runner-screen" class="hide fixed inset-0 bg-white z-[220] p-5 text-center flex flex-col">
        <div class="flex justify-between items-center pt-10 mb-4">
            <span class="text-blue-600 font-black text-[12px] uppercase">âš¡ Session Active</span>
            <button onclick="openSkipModal()" class="bg-red-600 text-white px-6 py-2 rounded-full font-black text-[12px] uppercase italic">Skip â­</button>
        </div>

        <div class="bg-white p-8 rounded-[40px] border-[6px] border-blue-500 shadow-xl mb-6 flex items-center justify-center min-h-[150px]">
            <h2 id="display-goal-name" class="text-2xl font-black uppercase text-gray-800"></h2>
        </div>

        <div class="grid grid-cols-2 gap-3 flex-1 pb-6">
            <button onclick="handleResult('IND')" class="bg-green-600 text-white rounded-2xl font-black text-[11px] uppercase">Independent</button>
            <button onclick="handleResult('POS')" class="bg-yellow-500 text-white rounded-2xl font-black text-[11px] uppercase">Positional</button>
            <button onclick="handleResult('GES')" class="bg-teal-500 text-white rounded-2xl font-black text-[11px] uppercase">Gestural</button>
            <button onclick="handleResult('VB')" class="bg-blue-500 text-white rounded-2xl font-black text-[11px] uppercase">Verbal</button>
            <button onclick="handleResult('PP')" class="bg-orange-400 text-white rounded-2xl font-black text-[11px] uppercase">Partial Phys</button>
            <button onclick="handleResult('FP')" class="bg-orange-600 text-white rounded-2xl font-black text-[11px] uppercase">Full Phys</button>
            <button onclick="handleResult('INC')" class="bg-red-600 text-white rounded-2xl font-black text-[11px] uppercase">Incorrect</button>
            <button onclick="handleResult('NR')" class="bg-gray-500 text-white rounded-2xl font-black text-[11px] uppercase">No Response</button>
            <button onclick="handleResult('PB')" class="col-span-2 bg-purple-700 text-white py-5 rounded-2xl font-black text-[13px] uppercase">ğŸƒ Problem Behavior</button>
        </div>
        
        <button onclick="pauseSession()" class="text-gray-400 font-bold uppercase text-[11px] mb-6 underline">Pause and Return</button>
    </div>

    <div id="skip-modal" class="hide fixed inset-0 bg-black/90 z-[400] flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-xs rounded-[40px] p-8 shadow-2xl text-center">
            <p class="font-black uppercase text-gray-400 mb-6 tracking-widest">Reason for Skip</p>
            <div class="grid grid-cols-1 gap-4">
                <button onclick="executeSkip('REFUSAL')" class="bg-red-500 text-white py-5 rounded-2xl font-black uppercase text-xs">ğŸš« Refusal / PB</button>
                <button onclick="executeSkip('NO MATERIALS')" class="bg-gray-700 text-white py-5 rounded-2xl font-black uppercase text-xs">ğŸ“¦ No Materials</button>
                <button onclick="executeSkip('INTERRUPTED')" class="bg-blue-600 text-white py-5 rounded-2xl font-black uppercase text-xs">âš ï¸ Interrupted</button>
                <button onclick="hide('skip-modal')" class="text-gray-400 py-2 font-black uppercase mt-2">Back</button>
            </div>
        </div>
    </div>

    <div id="profile-selector" class="fixed inset-0 bg-blue-900 z-[100] p-6 flex flex-col items-center hide">
        <h1 class="text-white font-black text-3xl mb-8 mt-10 uppercase italic">Profiles</h1>
        <div id="profile-list" class="w-full max-w-xs space-y-3 mb-8"></div>
        <input id="new-profile-input" type="text" placeholder="NAME..." class="w-full max-w-xs p-4 rounded-2xl mb-4 uppercase font-bold outline-none">
        <button onclick="addNewProfile()" class="w-full max-w-xs bg-green-500 text-white font-black py-5 rounded-2xl">+ ADD STUDENT</button>
    </div>

    <div id="location-selector" class="fixed inset-0 bg-gray-100 z-[90] hide p-6 flex flex-col items-center">
        <h1 class="font-black text-2xl mb-6 mt-10 uppercase text-blue-900 italic underline">Location</h1>
        <div id="location-list" class="grid grid-cols-2 gap-4 w-full max-w-md"></div>
    </div>

    <script>
        let user, loc, filter, activeGoal;

        function dbGet() { return JSON.parse(localStorage.getItem(`data_${user}_${loc}`) || '[]'); }
        function dbSave(d) { localStorage.setItem(`data_${user}_${loc}`, JSON.stringify(d)); }
        function show(id) { document.getElementById(id).classList.remove('hide'); }
        function hide(id) { document.getElementById(id).classList.add('hide'); }

        function init() {
            user = localStorage.getItem('u'); loc = localStorage.getItem('l');
            filter = localStorage.getItem('f') || 'baseline';
            if (user && loc) { renderMain(); } 
            else if (user) { renderLocs(); } 
            else { renderProfs(); }
        }

        function renderMain() {
            hide('profile-selector'); hide('location-selector'); show('app-interface');
            document.getElementById('user-label').innerText = user + ' | ' + loc;
            refreshList();
        }

        function switchTab(t) {
            filter = t; localStorage.setItem('f', t);
            hide('runner-screen'); show('app-interface');
            refreshList();
        }

        function refreshList() {
            const container = document.getElementById('main-list');
            if (!container) return;
            container.innerHTML = '';
            document.querySelectorAll('button[id^="tab-"]').forEach(b => b.classList.remove('act-t'));
            document.getElementById('tab-' + filter)?.classList.add('act-t');

            let data = dbGet();
            let qKey = `q_${user}_${loc}_${filter}`;
            let queue = JSON.parse(localStorage.getItem(qKey) || '[]');

            if (['baseline', 'treatment', 'maintenance', 'mastered'].includes(filter)) {
                let items = data.filter(i => i.f === filter && !i.done);
                container.innerHTML = `
                    <div class="flex gap-3 mb-6">
                        <button onclick="startSession()" class="flex-1 bg-black text-white py-5 rounded-2xl font-black uppercase text-xs shadow-xl">
                            ${queue.length ? 'â–¶ Resume Session' : 'ğŸš€ Start Random'}
                        </button>
                        ${queue.length ? `<button onclick="resetSession()" class="bg-gray-200 text-gray-500 px-5 rounded-2xl font-black text-[10px]">RESET</button>` : ''}
                    </div>
                    <div class="bg-white p-5 rounded-[30px] border-2 mb-6">
                        <input id="goal-in" type="text" placeholder="GOAL NAME..." class="w-full p-4 border-2 rounded-2xl mb-3 uppercase font-black text-sm outline-none">
                        <button onclick="addGoal()" class="w-full bg-blue-600 text-white py-3 rounded-2xl font-black uppercase text-[11px]">+ Add Goal</button>
                    </div>
                `;

                items.forEach(item => {
                    let isNext = queue[0] == item.id;
                    container.innerHTML += `
                        <div class="bg-white p-5 rounded-[25px] border-2 ${isNext ? 'border-indigo-600 shadow-md ring-2 ring-indigo-100' : 'border-gray-100'} flex justify-between items-center mb-3">
                            <div onclick="launch(${item.id})" class="flex-1 font-black uppercase text-[15px]">${item.text}</div>
                            <button onclick="removeGoal(${item.id})" class="text-red-200 font-bold text-xl px-2">âœ•</button>
                        </div>
                    `;
                });
            } else {
                container.innerHTML = `<h2 class="text-xl font-black uppercase italic mb-6 underline">ğŸ“œ ${filter}</h2>`;
                data.filter(i => i.f === filter).reverse().forEach(entry => {
                    container.innerHTML += `<div class="bg-white p-4 rounded-2xl border-2 mb-2 font-black uppercase text-[11px] flex justify-between"><span>${entry.text}</span><span class="text-indigo-600">${entry.res}</span></div>`;
                });
            }
        }

        function startSession() {
            let items = dbGet().filter(i => i.f === filter && !i.done);
            if (!items.length) return;
            let ids = items.map(i => i.id).sort(() => Math.random() - 0.5);
            localStorage.setItem(`q_${user}_${loc}_${filter}`, JSON.stringify(ids));
            launch(ids[0]);
        }

        function launch(id) {
            let data = dbGet();
            let item = data.find(i => i.id == id);
            if (!item) return;
            activeGoal = item;
            document.getElementById('display-goal-name').innerText = item.text;
            hide('app-interface'); hide('skip-modal'); show('runner-screen');
        }

        function handleResult(val) {
            let data = dbGet();
            data.push({ id: Date.now(), text: activeGoal.text, res: val, f: 'recall' });
            dbSave(data);
            advance();
        }

        function openSkipModal() { show('skip-modal'); }

        function executeSkip(reason) {
            let qKey = `q_${user}_${loc}_${filter}`;
            let queue = JSON.parse(localStorage.getItem(qKey) || '[]');
            if (queue.length) {
                let data = dbGet();
                data.push({ id: Date.now(), text: activeGoal.text, res: 'SKIP: ' + reason, f: 'recall' });
                dbSave(data);
                let cid = queue.shift();
                queue.push(cid);
                localStorage.setItem(qKey, JSON.stringify(queue));
                launch(queue[0]);
            }
        }

        function advance() {
            let qKey = `q_${user}_${loc}_${filter}`;
            let queue = JSON.parse(localStorage.getItem(qKey) || '[]');
            queue.shift();
            localStorage.setItem(qKey, JSON.stringify(queue));
            if (queue.length) launch(queue[0]); else pauseSession();
        }

        function pauseSession() { hide('runner-screen'); show('app-interface'); refreshList(); }
        function resetSession() { localStorage.removeItem(`q_${user}_${loc}_${filter}`); refreshList(); }
        
        function addGoal() {
            let v = document.getElementById('goal-in').value.trim().toUpperCase();
            if (!v) return;
            let data = dbGet();
            data.push({ id: Date.now(), text: v, f: filter, done: false });
            dbSave(data);
            document.getElementById('goal-in').value = ''; refreshList();
        }

        function renderProfs() {
            show('profile-selector');
            const c = document.getElementById('profile-list');
            let p = JSON.parse(localStorage.getItem('profiles') || '[]');
            c.innerHTML = '';
            p.forEach(n => { c.innerHTML += `<button onclick="setU('${n}')" class="w-full bg-white p-5 rounded-2xl font-black uppercase text-left mb-3 shadow-md">ğŸ‘¤ ${n}</button>`; });
        }
        function setU(n) { localStorage.setItem('u', n); user = n; renderLocs(); }
        
        function renderLocs() {
            hide('profile-selector'); show('location-selector');
            const c = document.getElementById('location-list');
            c.innerHTML = '';
            ["DTT Room", "Gym", "Sensory", "Outside", "Bathroom", "Centers"].forEach(lName => {
                c.innerHTML += `<button onclick="setL('${lName}')" class="bg-white p-5 rounded-3xl border-4 font-black uppercase text-[12px] h-28 shadow-lg">ğŸ“ ${lName}</button>`;
            });
        }
        function setL(lName) { localStorage.setItem('l', lName); loc = lName; renderMain(); }

        function removeGoal(id) { if (confirm("Delete?")) { let d = dbGet().filter(i => i.id != id); dbSave(d); refreshList(); } }
        function exitUser() { localStorage.removeItem('u'); location.reload(); }
        function exitLocation() { localStorage.removeItem('l'); location.reload(); }

        init();
    </script>
</body>
</html>
