<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tracker Pro v6.6.8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-tab { border-bottom: 4px solid #4f46e5; color: #4f46e5; }
        .hide { display: none !important; }
        /* Visual feedback on press */
        button:active { transform: scale(0.95); filter: brightness(0.8); transition: 0.1s; }
    </style>
</head>
<body class="bg-gray-100 font-sans pb-24 text-gray-900">

    <div onclick="exitUser()" class="bg-black text-white text-[10px] font-bold text-center py-1 uppercase sticky top-0 z-[150] cursor-pointer">
        v6.6.8 | ğŸ‘¤ SWITCH USER
    </div>

    <div id="app-interface" class="hide min-h-screen">
        <div class="bg-white sticky top-7 z-50 shadow-sm">
            <div class="flex justify-between p-2 bg-gray-50 border-b text-[10px] font-black uppercase">
                 <button onclick="exitLocation()" class="text-blue-600">â¬… ğŸ“ LOCATIONS</button>
                 <span id="user-label" class="text-gray-400"></span>
            </div>
            
            <div class="flex">
                <button onclick="switchTab('baseline')" id="tab-baseline" class="p-4 flex-1 text-[10px] font-bold uppercase">Base</button>
                <button onclick="switchTab('treatment')" id="tab-treatment" class="p-4 flex-1 text-[10px] font-bold uppercase">TX</button>
                <button onclick="switchTab('maintenance')" id="tab-maintenance" class="p-4 flex-1 text-[10px] font-bold uppercase">Maint</button>
            </div>
        </div>

        <div id="main-list" class="p-4 space-y-3 pb-20 max-w-md mx-auto"></div>

        <div class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 shadow-lg z-50">
            <button onclick="switchTab('trials')" id="tab-trials" class="flex flex-col items-center w-1/4">
                <span class="text-xl">ğŸ“Š</span><span class="text-[8px] font-black uppercase">Trials</span>
            </button>
            <button onclick="switchTab('mastered')" id="tab-mastered" class="flex flex-col items-center w-1/4">
                <span class="text-xl">ğŸ†</span><span class="text-[8px] font-black uppercase">Master</span>
            </button>
            <button onclick="switchTab('ta_history')" id="tab-ta_history" class="flex flex-col items-center w-1/4">
                <span class="text-xl">ğŸ“</span><span class="text-[8px] font-black uppercase">TA Logs</span>
            </button>
            <button onclick="switchTab('recall')" id="tab-recall" class="flex flex-col items-center w-1/4">
                <span class="text-xl">ğŸ“‹</span><span class="text-[8px] font-black uppercase">Recall</span>
            </button>
        </div>
    </div>

    <div id="runner-screen" class="hide fixed inset-0 bg-white z-[220] p-4 text-center flex flex-col">
        <div class="flex justify-between items-center pt-8 mb-4">
            <span class="text-blue-500 font-black text-[10px] uppercase">âš¡ ACTIVE SESSION</span>
            <button onclick="showSkipModal()" class="bg-red-600 text-white px-6 py-2 rounded-full font-black text-[10px] italic shadow-md">SKIP â­</button>
        </div>

        <div class="bg-gray-50 p-6 rounded-[30px] border-4 border-blue-500 mb-4 flex items-center justify-center min-h-[120px]">
            <h2 id="current-task-name" class="text-xl font-black uppercase"></h2>
        </div>

        <div class="grid grid-cols-2 gap-2 flex-1 pb-4">
            <button onclick="recordResult('IND')" class="bg-green-600 text-white rounded-xl font-black text-[10px] uppercase">ğŸŒŸ Independent</button>
            <button onclick="recordResult('POS')" class="bg-yellow-500 text-white rounded-xl font-black text-[10px] uppercase">ğŸ“ Positional</button>
            <button onclick="recordResult('GES')" class="bg-teal-500 text-white rounded-xl font-black text-[10px] uppercase">ğŸ‘‹ Gestural</button>
            <button onclick="recordResult('VB')" class="bg-blue-500 text-white rounded-xl font-black text-[10px] uppercase">ğŸ—£ Verbal</button>
            <button onclick="recordResult('PP')" class="bg-orange-400 text-white rounded-xl font-black text-[10px] uppercase">ğŸ‘ Partial Phys</button>
            <button onclick="recordResult('FP')" class="bg-orange-600 text-white rounded-xl font-black text-[10px] uppercase">ğŸ¤ Full Phys</button>
            <button onclick="recordResult('INC')" class="bg-red-600 text-white rounded-xl font-black text-[10px] uppercase">âŒ Incorrect</button>
            <button onclick="recordResult('NR')" class="bg-gray-500 text-white rounded-xl font-black text-[10px] uppercase">âšª No Response</button>
            <button onclick="recordResult('PB')" class="col-span-2 bg-purple-700 text-white py-4 rounded-xl font-black text-[10px] uppercase">ğŸƒ Problem Behavior</button>
        </div>
        
        <button onclick="closeRunner()" class="text-gray-400 font-bold uppercase text-[10px] py-4 underline">â¸ PAUSE SESSION</button>
    </div>

    <div id="skip-modal" class="hide fixed inset-0 bg-black/90 z-[400] flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-xs rounded-3xl p-6 shadow-2xl">
            <p class="font-black uppercase text-gray-400 mb-6 text-center">WHY SKIP? â­</p>
            <div class="grid grid-cols-1 gap-3">
                <button onclick="processSkip('REFUSAL')" class="bg-red-500 text-white py-4 rounded-xl font-black uppercase text-xs">ğŸš« Student Refusal</button>
                <button onclick="processSkip('NO MATERIALS')" class="bg-gray-700 text-white py-4 rounded-xl font-black uppercase text-xs">ğŸ“¦ No Materials</button>
                <button onclick="processSkip('INTERRUPTED')" class="bg-blue-600 text-white py-4 rounded-xl font-black uppercase text-xs">âš ï¸ Interrupted</button>
                <button onclick="hide('skip-modal')" class="text-gray-400 py-2 font-bold uppercase text-center mt-2">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="profile-selector" class="fixed inset-0 bg-blue-900 z-[100] p-6 flex flex-col items-center hide">
        <h1 class="text-white font-black text-3xl mb-8 uppercase italic mt-10">STUDENTS ğŸ‘¤</h1>
        <div id="profile-list" class="w-full max-w-xs space-y-3 mb-8"></div>
        <input id="new-profile-input" type="text" placeholder="NAME..." class="w-full max-w-xs p-4 rounded-2xl mb-4 uppercase font-bold outline-none">
        <button onclick="addNewProfile()" class="w-full max-w-xs bg-green-500 text-white font-black py-5 rounded-2xl shadow-lg">+ ADD NEW</button>
    </div>

    <div id="location-selector" class="fixed inset-0 bg-gray-100 z-[90] hide p-6 flex flex-col items-center">
        <h1 class="font-black text-2xl mb-6 uppercase text-blue-900 italic mt-10">LOCATIONS ğŸ“</h1>
        <div id="location-list" class="grid grid-cols-2 gap-4 w-full max-w-md"></div>
    </div>

    <script>
        let currentUser, currentLocation, currentFilter;
        let activeGoal;

        const getDatabase = () => JSON.parse(localStorage.getItem(`data_${currentUser}_${currentLocation}`) || '[]');
        const saveDatabase = (data) => localStorage.setItem(`data_${currentUser}_${currentLocation}`, JSON.stringify(data));
        const show = (id) => document.getElementById(id).classList.remove('hide');
        const hide = (id) => document.getElementById(id).classList.add('hide');

        function initApp() {
            currentUser = localStorage.getItem('currentUser');
            currentLocation = localStorage.getItem('currentLocation');
            currentFilter = localStorage.getItem('currentFilter') || 'baseline';
            if (currentUser && currentLocation) { loadMainInterface(); } 
            else if (currentUser) { renderLocationSelector(); } 
            else { renderProfileSelector(); }
        }

        function loadMainInterface() {
            hide('location-selector'); hide('profile-selector'); show('app-interface');
            document.getElementById('user-label').innerText = `${currentUser} | ${currentLocation}`;
            refreshGoalList();
        }

        function switchTab(newTab) {
            currentFilter = newTab;
            localStorage.setItem('currentFilter', newTab);
            hide('runner-screen'); show('app-interface');
            refreshGoalList();
        }

        function refreshGoalList() {
            const listContainer = document.getElementById('main-list');
            listContainer.innerHTML = '';
            document.querySelectorAll('button[id^="tab-"]').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById('tab-' + currentFilter)?.classList.add('active-tab');

            let database = getDatabase();
            let queueKey = `queue_${currentUser}_${currentLocation}_${currentFilter}`;
            let sessionQueue = JSON.parse(localStorage.getItem(queueKey) || '[]');

            if (['baseline', 'treatment', 'maintenance', 'mastered'].includes(currentFilter)) {
                let tasks = database.filter(t => t.filter === currentFilter && !t.completed);
                listContainer.innerHTML = `
                    <div class="flex gap-2 mb-4">
                        <button onclick="startSession()" class="flex-1 bg-black text-white py-4 rounded-2xl font-black uppercase text-xs shadow-lg">
                            ${sessionQueue.length ? 'â–¶ RESUME' : 'ğŸš€ START SESSION'}
                        </button>
                        ${sessionQueue.length ? `<button onclick="resetSession()" class="bg-gray-200 text-gray-500 px-4 rounded-2xl font-black text-[10px]">ğŸ”„ RESET</button>` : ''}
                    </div>
                    <div class="bg-white p-4 rounded-2xl border mb-4">
                        <input id="goal-input" type="text" placeholder="NEW GOAL..." class="w-full p-3 border-2 rounded-xl mb-2 uppercase font-bold text-sm">
                        <button onclick="addGoal()" class="w-full bg-blue-600 text-white py-2 rounded-xl text-[10px] font-bold uppercase">+ ADD GOAL</button>
                    </div>
                `;

                tasks.forEach(task => {
                    let isNext = sessionQueue[0] == task.id;
                    listContainer.innerHTML += `
                        <div class="bg-white p-4 rounded-xl border ${isNext ? 'border-indigo-500 border-2 shadow-md' : ''} flex justify-between items-center mb-2">
                            <div onclick="launchGoal(${task.id})" class="flex-1 font-black uppercase text-sm">${task.text}</div>
                            <button onclick="deleteGoal(${task.id})" class="text-red-200 px-2">âœ•</button>
                        </div>
                    `;
                });
            } else {
                listContainer.innerHTML = `<h2 class="text-xl font-black uppercase italic mb-4 underline">ğŸ“œ ${currentFilter}</h2>`;
                database.filter(t => t.filter === currentFilter).reverse().forEach(entry => {
                    listContainer.innerHTML += `<div class="bg-white p-3 rounded-xl border mb-2 font-black uppercase text-[10px] flex justify-between"><span>${entry.text}</span><span class="text-indigo-600">${entry.result}</span></div>`;
                });
            }
        }

        function startSession() {
            let tasks = getDatabase().filter(t => t.filter === currentFilter && !t.completed);
            if (!tasks.length) return;
            let ids = tasks.map(t => t.id).sort(() => Math.random() - 0.5);
            localStorage.setItem(`queue_${currentUser}_${currentLocation}_${currentFilter}`, JSON.stringify(ids));
            launchGoal(ids[0]);
        }

        function launchGoal(id) {
            let database = getDatabase();
            let goal = database.find(g => g.id == id);
            if (!goal) return;
            activeGoal = goal;
            document.getElementById('current-task-name').innerText = goal.text;
            hide('app-interface'); hide('skip-modal'); show('runner-screen');
        }

        function recordResult(val) {
            let database = getDatabase();
            database.push({ id: Date.now(), text: activeGoal.text, result: val, filter: 'recall', date: new Date().toLocaleDateString() });
            saveDatabase(database);
            advanceQueue();
        }

        function showSkipModal() { show('skip-modal'); }

        function processSkip(reason) {
            let qKey = `queue_${currentUser}_${currentLocation}_${currentFilter}`;
            let queue = JSON.parse(localStorage.getItem(qKey) || '[]');
            if (queue.length > 0) {
                let database = getDatabase();
                database.push({ id: Date.now(), text: activeGoal.text, result: 'SKIP: ' + reason, filter: 'recall' });
                saveDatabase(database);
                let currentId = queue.shift();
                queue.push(currentId);
                localStorage.setItem(qKey, JSON.stringify(queue));
                launchGoal(queue[0]);
            }
        }

        function advanceQueue() {
            let qKey = `queue_${currentUser}_${currentLocation}_${currentFilter}`;
            let queue = JSON.parse(localStorage.getItem(qKey) || '[]');
            queue.shift();
            localStorage.setItem(qKey, JSON.stringify(queue));
            if (queue.length > 0) launchGoal(queue[0]); else closeRunner();
        }

        function closeRunner() { hide('runner-screen'); show('app-interface'); refreshGoalList(); }
        function resetSession() { localStorage.removeItem(`queue_${currentUser}_${currentLocation}_${currentFilter}`); refreshGoalList(); }
        function addGoal() {
            let input = document.getElementById('goal-input');
            let val = input.value.trim().toUpperCase();
            if (!val) return;
            let database = getDatabase();
            database.push({ id: Date.now(), text: val, filter: currentFilter, completed: false });
            saveDatabase(database);
            input.value = ''; refreshGoalList();
        }

        function renderProfileSelector() {
            show('profile-selector');
            const container = document.getElementById('profile-list');
            let profiles = JSON.parse(localStorage.getItem('profiles') || '[]');
            container.innerHTML = '';
            profiles.forEach(p => {
                container.innerHTML += `<button onclick="setProfile('${p}')" class="w-full bg-white p-4 rounded-2xl font-black uppercase text-left shadow-sm">ğŸ‘¤ ${p}</button>`;
            });
        }

        function setProfile(name) { localStorage.setItem('currentUser', name); currentUser = name; renderLocationSelector(); }
        function addNewProfile() {
            let input = document.getElementById('new-profile-input');
            let val = input.value.trim().toUpperCase();
            if (!val) return;
            let profiles = JSON.parse(localStorage.getItem('profiles') || '[]');
            profiles.push(val);
            localStorage.setItem('profiles', JSON.stringify(profiles));
            input.value = ''; renderProfileSelector();
        }

        function renderLocationSelector() {
            hide('profile-selector'); show('location-selector');
            const container = document.getElementById('location-list');
            container.innerHTML = '';
            ["DTT Room", "Gym", "Sensory", "Outside", "Bathroom", "Centers"].forEach(loc => {
                container.innerHTML += `<button onclick="setLocation('${loc}')" class="bg-white p-4 rounded-2xl border font-black uppercase text-[10px] h-24 shadow-sm">ğŸ“ ${loc}</button>`;
            });
        }

        function setLocation(loc) { localStorage.setItem('currentLocation', loc); currentLocation = loc; loadMainInterface(); }
        function deleteGoal(id) { if (confirm("Delete?")) { let d = getDatabase().filter(g => g.id != id); saveDatabase(d); refreshGoalList(); } }
        function exitUser() { localStorage.removeItem('currentUser'); location.reload(); }
        function exitLocation() { localStorage.removeItem('currentLocation'); location.reload(); }

        initApp();
    </script>
</body>
</html>
